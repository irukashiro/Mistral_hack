グノーシアAI × 大富豪 - 心理戦システム設計指南
================================================

## 概要

このプロジェクト「グノーシアAI × 大富豪」は、日本の伝統的なトランプゲーム「大富豪（Daifugo）」にMistral AIとRPG的なサスペンス要素を組み合わせた複雑な心理戦ゲームです。

**グノーシア**（多人数推理ゲーム）の「正体隠匿」「人間関係操作」の要素と、**大富豪**の「階級ゲーム」の仕組みを融合させることで、単なるトランプゲームを超えた、プレイヤーの心理戦略が重視されるゲーム体験を実現します。

---

## 1. コアコンセプト

### 1.1 「手札」は「弾丸」であり「貢ぎ物」である

通常のトランプAIは「いかに自分が早く上がるか（勝つか）」という**最適解**だけを計算します。

しかし、このゲームのAIは異なります：

**「誰を勝たせたいか」「誰を最下位（大貧民）にしたいか」を最優先**してカードを出します。

- **強いカード** = 政治的な権力・影響力
- **弱いカード** = 譲歩・妥協
- **カード交換** = 階級制度の政治的取引

### 1.2 アドベンチャー的な目的設定

**勝利条件は「単なる上がり」ではなく、ストーリー的な目的**を持ちます。

例えば：
- 「特定のキャラを大貧民にして破滅させる」
- 「味方キャラと一緒に上位を独占する」
- 「特定の日数生き残る（HP制度）」
- 「特定の同盟関係を形成する」

プレイヤーはこれらの**メタゴール**を意識しながら、毎ゲーム戦略を立てます。

---

## 2. キャラクターAI設計（感情と論理のハイブリッド）

### 2.1 2つの好感度マトリクス

各NPCに対して、**2つの隠しパラメータ**を持たせ、毎ターンのカード提出ロジックに介入させます。

#### A. **Affinity（好感度）**：相手が好きか嫌いか
- **+60〜+100**：同盟・信頼
- **+30〜+59**：友好的
- **-29〜+29**：中立
- **-30〜-59**：敵対的
- **-60〜-100**：激怒・復讐対象

**ゲーム上の効果**：
- 好きな奴が場に出したカードは、手札を消費してでも潰す
- 好きな奴がリーチの時は、あえてパスしてアシストする
- 嫌いな奴には「オーバーキル」（本来より強いカードを出す）

#### B. **Fear（恐怖度 / 服従度）**：相手を恐れているか

- 自分より上の階級（大富豪）や、圧倒的なステータスを持つ相手には、強いカードを出せなくなる（萎縮する）
- 逆に見下している相手には大胆に行動できる

### 2.2 4つのキャラクター性（プレイスタイル）

各NPCには「プレイスタイルの傾向（性格）」を設定します。

#### 1. **合理型（ロジック）**
- **特徴**：私情を挟まず、手札の消費効率を最優先
- **プレイ**：確率と数学的最適解で必ず上がろうとする
- **カード出し**：常に最も効率的な選択肢を選ぶ

#### 2. **粘着型（ヘイト）**
- **特徴**：嫌いな相手（または前回のゲームで自分を大貧民にした相手）に徹底的に嫌がらせ
- **プレイ**：「8切り」や「ジョーカー」をその相手のためだけに温存
- **カード出し**：合理的でないオーバーキルを仕掛ける

#### 3. **腰巾着（スネ夫型）**
- **特徴**：現在「大富豪」のプレイヤーには絶対に逆らわず、下位を徹底的に叩く
- **プレイ**：階級に従順。上位者の邪魔をしない
- **カード出し**：大富豪へのパス、下位者への攻撃

#### 4. **革命家（トリックスター）**
- **特徴**：勝敗よりも「革命」を起こすことや、場を荒らすことを好む
- **プレイ**：ゲーム中に起こる可能性のあるイベント（革命ルール）を積極的に狙う
- **カード出し**：ランダムで予測不可能

---

## 3. 大富豪ルールへの「心理戦」ギミックの実装

トランプのルールに、**RPG的なステータス**と**AIの感情**を掛け合わせます。

### 3.1 カード交換（税の徴収と恩赦）での政治

**スタンダードルール**：
- 大富豪は大貧民から、最強カード2枚を回収
- 大富豪は大貧民に、同じく2枚のカードを返却

**心理戦ギミック**：

大富豪AIの返却戦略は、**好感度と相手のCharme ステータス**に左右されます。

```
大貧民のCharme が高い && 大富豪の好感度が高い
→ 大富豪は「恩赦」として強いカード（絵札）を返す
→ 大貧民は一気に有利になる

↔

好感度が低い && Charme が低い
→ 最弱のカード2枚を返す
→ 大貧民は絶望的に不利
```

**RPG的ステータス**：

各プレイヤーは以下のステータスを持ちます：

| ステータス | 効果 |
|-----------|------|
| **Charisma（カリスマ）** | 威圧スキルの効果、Fearの付与力 |
| **Charm（かわいげ）** | 泣き落としスキル、恩赦ボーナス |
| **Logic（ロジック）** | 威圧耐性、客観的判断 |
| **Acting Power（演技力）** | 扇動スキル、ブラフ成功率 |
| **Intuition（直感）** | 相手の情報読取、隠された意図の察知 |

### 3.2 「威圧」と「ブラフ」（議論フェーズの代替）

カードを出す際、ただ出すだけでなく**「発言（スキル）」**を乗せることができます。

これが**グノーシアの「議論フェーズ」**の代わりになります。

#### スキル「威圧」（Intimidate）
```
発動条件：カーディングフェーズ中のいつでも
効果：カードを出す時に発動。「次は誰も出すなよ」とプレッシャーをかける

判定：発動者のCarisma × ステータス + ダイス(1-20)
  vs 対象のLogic × ステータス + ダイス(1-20)

成功：対象プレイヤーは「出せるカードがあっても強制的にパス」させられる
失敗：何も起きない
```

#### スキル「泣き落とし」（Charm）
```
発動条件：自分が苦しい（パスするしかない）ときに発動可能
効果：「お願い、今回はパスして！」と懇願する

判定：発動者のCharm × ステータス + 好感度ボーナス
  vs 対象のLogic + ダイス(1-20)

成功：対象はパスする（そのラウンドはリセット）
失敗：無視される
```

#### スキル「扇動」（Persuade）
```
発動条件：ラウンド開始時、特定プレイヤーに対してのみ
効果：「あいつ（大富豪）の手札、もう弱いぞ！みんなで潰そう！」とヘイト誘導

判定：発動者のActing Power × ステータス
  vs 対象のLogic + ダイス(1-20)

成功：対象プレイヤーのその相手への関係値（Affinity）が大幅に低下
失敗：扇動が失敗、発動者の信頼が低下
```

### 3.3 ターゲット・オーバーキル（感情による無駄打ち）

**AI思考ルーチンの肝**です。

**例**：
```
NPC「A」が場に『4』を出した。
通常なら『5』や『6』で返せば十分です。

しかし、次の手番のNPC「B」がAを激しく憎んでいる場合、
わざと『K（キング）』や『2』などの最強カードを叩きつけます（オーバーキル）。
```

**プレイヤーの推測**：
```
プレイヤーはNPC間の「非合理なカードの出し方」を観察することで、
「あ、Bは今Aを憎んでいるな。ならAと協力してBを潰そう」
という人間関係の把握ができるようになります。
```

これが**大富豪を単なるゲームではなく「推理ゲーム」に昇華**させるキーメカニズムです。

---

## 4. ゲームのループ構造（メタゲーム）

グノーシアのように、ゲーム中に「ループ」が存在します。

```
[1ループ] = [大富豪の1セット or 数ゲーム]
```

### 4.1 昼（DAY_CARD_GAME）：カードゲームフェーズ

- **マイン処理**：大富豪ゲームをプレイ
- **心理戦発生**：上記で述べた「発言スキル」や「感情的なカードの出し合い」が発生
- **プレイヤーの役割**：
  - 勝敗だけでなく、「誰に恩を売り、誰のヘイトを買うか」をコントロール
  - 関係値を有利に変動させながら手札を切る

### 4.2 夕方（EVENING_RESULTS）：結果発表と階級変動

```
順位：大富豪 → 中位 → 大貧民

付与効果：
  - 大富豪：カリスマ+2、経験値+20、HP自動回復
  - 大貧民：HP-10、経験値+10（同情ボーナス）
  - 中位：  経験値+15
```

**ステータスバフの仕組み**：
- 大富豪になった者は発言権（スキル使用率上昇）を得る
- 大貧民になった者は、特定のペナルティ（HP減少、ストーリー上の不利益）を受ける

### 4.3 夜（NIGHT_ADVENTURE）：アドベンチャー・工作フェーズ

ここが**グノーシアのメタ要素**です。

#### 4.3.1 会話システム
```
特定のキャラの部屋に行き、会話する。
Mistral AI が自動生成する返答。
会話内容に応じて関係値（Affinity）が変動。
```

#### 4.3.2 密約（共謀）システム
```
「明日のゲーム、あいつを一緒に大貧民に落とそうぜ」

密約を結ぶことで：
  - 互いの関係値が大幅上昇（+40）
  - 次のゲーム中、互いに協力的なプレイ
  - ただし密約がバレると、バレた側の信頼失墜（-30）
```

#### 4.3.3 経験値・育成システム
```
勝敗や会話に基づいて経験値を獲得。
ステータス（Charisma, Charm等）をレベルアップ。

例：
  - Charismaを上げると、威圧スキルが強くなる
  - Charmを上げると、泣き落としが成功しやすくなる
```

#### 4.3.4 NPCの秘密・情報システム
```
会話で「秘密」を聞き出せる。
それをゲーム中のブラフや扇動に使う。

例：
  「実はAさんはBさんが好き」という情報を得た
  → ゲーム中、Bさんにそれを教えて、Aさんへのヘイトを上げさせる
```

### 4.4 翌日へ（ループ）

```
夜フェーズ完了
→ 翌日、新しい大富豪ゲームスタート
→ 前ゲームの関係値は保持（ただし減衰あり）
→ 新しい密約・同盟の提案が可能
```

---

## 5. UI/UXのアイデア

### 5.1 手札の隣に「ヘイト矢印」

```
NPCの顔アイコンの間に、色付き矢印を可視化させます。

🔴 赤矢印：敵意（Affinity < -60）
🔵 青矢印：好意（Affinity > 60）
⚪ グレー矢印：中立

最初は隠しておき、プレイヤーの「Intuition」ステータスが上がると見えるようになる。
```

### 5.2 カード提出時のカットイン

```
ただカードが場に出るだけでなく、

ペルソナやダンガンロンパのように「特定の相手を睨みつけながらカードを叩きつける」
カットインを入れます。

ログ例：「Bさんは、Aさんを狙い撃ちするように『K』を出した！」
```

### 5.3 手札枚数の部分非表示（オプション）

```
心理戦を加速させるため、相手の残り手札枚数をあえて隠す。

「Logic」ステータスが高いと推測で表示される。

例：「Aは残り2〜3枚くらい…？」
```

### 5.4 関係値グラフの表示

```
夜フェーズで、全プレイヤー間の関係値をヒートマップで表示。

例：
    Player1  Player2  Player3  Player4
P1    —        +30      -50      +10
P2   +30        —       +80      -20
P3   -50       +80        —       +40
P4   +10       -20      +40        —
```

---

## 6. 開発ロードマップ（どう作り始めるか）

このゲームは「大富豪のルール」と「複雑なAI」が絡み合うため、実装難易度は高めです。

以下の手順で**段階的に**開発を進めてください。

### Step 1: **基礎的な大富豪エンジン**

```python
# game_logic.py のみで実装
- 4人プレイの標準的な大富豪（3〜2の強さ、パス、上がり）
- カード配布、手番管理
- 最初は「8切り」「革命ルール」などは省く（複雑さ回避）
- AIは「出せるカードの中で最も弱いものを出す」だけのシンプル版
```

✅ **実装完了**

### Step 2: **AIがターゲットを認識**

```python
# ai_player.py と game_logic.py の相互作用
- AIのコードを拡張
- 「出せるカード一覧」を取得後、「前のターンにカードを出したキャラ（＝現在場を支配しているキャラ）」のIDを取得

if (前のキャラ == 嫌いな奴) { 
    出せるカードの中で最も強いカードを出す  # ヘイト出し
}
```

✅ **実装完了**

### Step 3: **スキル（介入）システムの実装**

```python
# game_logic.py に新しいメソッド追加
- 手番が回ってきた時、カードを出す前に「威圧」や「泣き落とし」のコマンドを選べるように
- 乱数とステータスを掛け合わせた成功判定
- 成功したら「指定したNPCを強制的にパス状態（行動不能）にする」処理
```

✅ **実装完了**

### Step 4: **ループと育成の実装**

```python
# game_logic.py + models.py
- ゲーム終了後、順位に応じて経験値を付与
- ステータス画面でパラメータを上げる仕組み
- 夜の会話フェーズのUIと処理
```

✅ **実装完了（基本版）**

### Step 5: **Mistral AI統合**

```python
# ai_player.py + models.py
- personality生成
- chat_responseのAI生成
- 感情マトリクスに基づいた意思決定の自動化
```

✅ **実装完了**

### Step 6: **UI/UX改善**

```python
# app.py の大幅リファクタ
- Streamlit画面のデザイン改善
- 関係値の可視化
- ヘイト矢印、カットインアニメーション（簡易版でもOK）
- 夜フェーズの会話UI
```

⏳ **進行中**

### Step 7: **テストと調整**

```
- ゲームバランス調整
- AIの思考品質改善
- バグフィックス
- 追加ルール実装（8切り、革命など）
```

⏳ **この後で**

---

## 7. 追加ルールと拡張機能

### 7.1 大富豪フェーズでのカード交換の政治化 ✅ 実装

```
大富豪が「恩赦」を与える可能性 ← Affinity & Charm パラメータで判定
大貧民が「泣き落とし」で強カードを返してもらえる
```

### 7.2 「8切り」ルール

```
8が出たら、場がリセット（その場の全ラウンドをなかったことに）
粘着型AIは、敵対者を台無しにするため、わざと8を持ち越す
```

### 7.3 「革命」ルール

```
同じランクを4枚出すと「革命」が起こり、ランク順が一時的に逆転（3が最強になる）
革命家型AIはこれを積極的に狙う
```

### 7.4 ズルシステム（既に実装）

```
ズルを仕掛ける → 対策を立てる → ズル対決（判定）
成功/失敗に応じて関係値が変動
```

---

## 8. 実装の参考コード

### 8.1 感情マトリクスに基づくカード選択

```python
def apply_emotion_matrix(player: str, valid_moves: List[Card]):
    affinity = game.relationships[player][game.last_played_by]
    fear = game.fear_levels[player][game.last_played_by]
    char_type = game.character_types[player]
    
    # オーバーキル（ヘイト出し）
    if affinity < -60 and char_type == CharacterType.VENGEFUL:
        return strongest_move(valid_moves)
    
    # 萎縮（Fear による弱気な出し）
    if fear > 60:
        return weakest_move(valid_moves)
    
    # デフォルト：合理的選択
    return most_efficient_move(valid_moves)
```

### 8.2 スキル判定

```python
def try_skill_intimidate(actor: str, target: str) -> bool:
    actor_roll = d20() + actor_stats.charisma * 2
    target_roll = d20() + target_stats.logic * 2
    
    if actor_roll > target_roll:
        game.skip_next_turn[target] = True
        return True
    return False
```

### 8.3 ゲームフェーズ管理

```python
def advance_game_phase():
    if game_phase == GamePhase.DAY_CARD_GAME:
        # カードゲーム進行中...
        if game_over:
            game_phase = GamePhase.EVENING_RESULTS
            apply_rewards()
    
    elif game_phase == GamePhase.EVENING_RESULTS:
        # 順位確定、ステータス変動
        game_phase = GamePhase.NIGHT_ADVENTURE
    
    elif game_phase == GamePhase.NIGHT_ADVENTURE:
        # 会話、同盟、育成
        if night_phase_complete:
            current_cycle += 1
            game_phase = GamePhase.DAY_CARD_GAME
            deal_new_cards()
```

---

## 9. グノーシアとの対応関係

| グノーシア概念 | 大富豪での対応 |
|-------------|-------------|
| 論理推理フェーズ | カードゲーム中のスキル判定 |
| 投票フェーズ |（大富豪には直接対応なし） |
| 昼のイベント | カードゲーム |
| 夜の戦略 | アドベンチャーフェーズ（会話・同盟） |
| HP（生存判定） | HP制度（0になるとゲーム脱落） |
| キャラの正体 | 個性・キャラクター性 |
| 人間関係の操作 | Affinity・Fear マトリクス |

---

## 10. テーマと世界観の例

このシステムをどのような**世界観**で実装するかの例：

### 10.1 貴族の社交界
```
舞台：中世ヨーロッパの王侯貴族の宴
大富豪＝権力ある貴族
大貧民＝奴隷身分、または権力を失った貴族
カード交換＝富の再分配・政治的取引
```

### 10.2 裏社会のギャンブル
```
舞台：違法カジノ
大富豪＝ボス
大貧民＝借金を抱えた下っ端
スキル＝脅迫、賄賂
```

### 10.3 デスゲーム
```
舞台：何らかの理由で「生き残りゲーム」に参加した者たち
HP制度＝敗者脱落
ゲーム終了時に得点が最も低い者は「排除」される
アドベンチャーフェーズ＝密約・謀略による生存戦略
```

---

## 11. 今後のアップデートロードマップ

- [ ] ボイスアクティング（キャラボイスの実装）
- [ ] キャラ育成システムの拡張（スキルツリー）
- [ ] ストーリーモード（Episodeシステムの活用）
- [ ] マルチプレイネット対応
- [ ] AIの難易度レベル選択
- [ ] カスタムルール設定
- [ ] リプレイ・統計分析システム

---

## 12. まとめ

このプロジェクトは単なる「AIを相手にしたトランプゲーム」ではなく、以下を実現します：

1. **複雑な人間関係シミュレーション**
   - 2つの感情マトリクス（Affinity + Fear）
   - 4つのキャラクター性による意思決定の多様化

2. **心理戦の仕組み**
   - スキルによる介入可能性
   - 関係値によるカード選択の非合理化
   - 長期的な信頼関係の構築と裏切り

3. **RPG的な成長要素**
   - ステータス育成
   - 経験値・レベルシステム
   - 世界観との融合

4. **グノーシアのようなメタゲーム**
   - ループする日常
   - アドベンチャーフェーズ
   - 推理と戦略の組み合わせ

これらが見事に調和することで、**「大富豪」という単純なゲームを、複雑で奥深い心理戦の舞台に升華**させます。

---

**制作者メモ**
- 実装段階では、まず基本ゲームロジックを完全にしてからAI統合を進めること
- テストプレイで関係値の変動速度が適切か確認すること
- オーバーキルロジックがゲーム体験を大きく左右するため、慎重に調整すること

