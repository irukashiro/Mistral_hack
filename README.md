# 大富豪 - Mistral AI版 🎴

StreamlitとMistral AIを使った大富豪（Daifugo）のトランプゲームです。

## 概要

大富豪は日本の伝統的なトランプゲームで、プレイヤーは前に出されたカードより強いカードを出す必要があります。このバージョンではMistral AIが他のプレイヤーの役割を果たし、心理戦や戦略的なゲームプレイを行います。

## 機能

- **4人プレイヤー対応**: 人間プレイヤーと最大3人のAIプレイヤー
- **Mistral AI統合**: AIプレイヤーが自然言語処理を使ってゲーム戦略を決定
- **直感的なUI**: Streamlitベースの使いやすいインターフェース
- **ゲーム状況の可視化**: 各プレイヤーの手札枚数、現在の場、ゲームログ

## インストール

### 前提条件
- Python 3.8以上
- Mistral API キー

### セットアップ手順

1. **リポジトリを複製**
```bash
cd Mistral_hack
```

2. **仮想環境を作成（推奨）**
```bash
python -m venv venv
source venv/Scripts/activate  # Windows
# または
source venv/bin/activate  # macOS/Linux
```

3. **依存関係をインストール**
```bash
pip install -r requirements.txt
```

4. **環境変数を設定**
```bash
# .env ファイルを作成
cp .env.example .env

# .env ファイルを編集して、Mistral API キーを設定
# MISTRAL_API_KEY=your_actual_api_key_here
```

## 使用方法

### Streamlitアプリを起動
```bash
streamlit run app.py
```

ブラウザが自動的に開き、アプリケーションが表示されます。（通常は http://localhost:8501）

## ゲームの流れ

1. **ゲーム開始**: サイドバーで設定し、「ゲームを開始」をクリック
2. **手札表示**: 自分の手札がカードボタンで表示されます
3. **カード選択**: クリックしてカードを選択（複数枚可）
4. **アクション実行**:
   - 🎯 **カードを出す**: 選択したカードをプレイ
   - 🚫 **パス**: カードを出さない
   - 🔄 **リセット**: 選択をクリア
5. **AI の順番**: 自動でAIが手を決定・実行
6. **ゲーム終了**: 最終順位が表示されます

## ゲームルール

### 基本ルール
- **開始**: 3のスペードを持つプレイヤーが最初にカードを出す
- **カード出し**: 前に出されたカードより強いランクのカードを出す
- **複数枚**: 同じランクの複数枚（ペア、トリプル）でプレイすることも可能
- **パス**: カードを出せない場合はパス
- **場のリセット**: 全員がパスすると、場が空になり最後に出したプレイヤーから再開
- **上がり**: 手札がすべてなくなったら上がり

### ランク順（弱→強）
```
3 < 4 < 5 < 6 < 7 < 8 < 9 < 10 < J < Q < K < A < 2
```

## アーキテクチャ

### ファイル構成
- **app.py**: Streamlit UIメイン
- **game_logic.py**: ゲームの規則とロジック
- **ai_player.py**: Mistral AIプレイヤーの実装
- **requirements.txt**: 依存パッケージ

### 主要クラス

#### Card
- トランプカードを表現
- スート（♠♥♦♣）とランク（3-2）を保持

#### DaifugoGame
- ゲーム全体のロジック
- デッキ管理、手札配布、ゲーム状態管理
- 有効な手の計算
- ゲーム進行

#### MistralAIPlayer
- Mistral APIを使ってAIプレイヤーを実装
- ゲーム状況を分析して最適な手を決定
- 心理戦を考慮した戦略的な判断

## Mistral AI統合

### AIの決定プロセス

1. **ゲーム状況の解析**
   - 現在の手札
   - 場に出ているカード
   - 他のプレイヤーの手札枚数
   - 現在の順位

2. **プロンプト生成**
   - ゲーム情報をテキスト化
   - 可能な手をリスト化
   - 大富豪の戦略ガイドラインを提供

3. **AI応答の解析**
   - AIの選択肢番号を抽出
   - 有効な手に変換
   - エラーハンドリング

### 考慮される戦略
- 自分が上がることを優先
- 強いカード（2, A, K）の温存
- 他のプレイヤーの手札枚数への対応
- リーダーの妨害

## トラブルシューティング

### "MISTRAL_API_KEYが設定されていません"エラー
- `.env` ファイルが正しく設定されているか確認
- YourMistral API キーが有効か確認

### AIが決定できないエラー
- ネットワーク接続を確認
- Mistral API キーの有効期限を確認
- API の使用制限に達していないか確認

### Streamlitの起動に失敗
```bash
pip install --upgrade streamlit
streamlit run app.py
```

## パフォーマンス最適化

- メッセージ数の制限: API呼び出しを最小化
- キャッシング: ゲーム状態の効率的な管理
- 段階的なAI応答解析

## 今後の機能拡張

- [ ] 複数のAIモデルの選択（Mistral Large など）
- [ ] ゲーム結果の統計・分析
- [ ] マルチプレイネット機能
- [ ] カスタムルール設定
- [ ] リプレイ機能
- [ ] AIの強度レベル選択

## ライセンス

MIT License

## 作成者

Mistral AI Hack Project 2026

## 参考リンク

- [Mistral AI](https://mistral.ai/)
- [Streamlit](https://streamlit.io/)
- [大富豪（Wikipedia）](https://ja.wikipedia.org/wiki/大富豪)

---

楽しいゲームプレイを！🎮
